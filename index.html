
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My New Home</title>
  <meta name="author" content="Martin Westin">

  
  <meta name="description" content="My case is that I have a Rails app. It uses Bundler to manage its Gems. I also need to run some processing using an old version of one of my own &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://eimer.co">
  <link href="/favicon.ico" rel="icon">

  <link href="/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/assets/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

  <link href="" rel="alternate" title="My New Home" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11893308-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    data-spy="scroll">

  <div class="container">
    <header class="jumbotron subhead" id="overview">
      <h1 class="title">My New Home</h1>

  <p class="lead">migrated from the 10 year-old eimermusic.com</p>


      <div class="navbar">
  <div class="navbar-inner">
    <div class="container" style="width: auto;">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <div class="nav-collapse">
                <ul class="nav">
          <li><a href="/">Home</a></li>
          <li><a href="/music">Music</a></li>
          <li><a href="/photos">Photos</a></li>
          <li><a href="/portfolio">Portfolio</a></li>
          <li><a href="/about">About</a></li>
        </ul>

        
          <form action="http://google.com/search" method="get" class="navbar-search pull-left">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:eimer.co" />
              <input type="text" name="q" results="0" placeholder="Search" class="search-query span2" />
            </fieldset>
          </form>
        
        
      </div><!-- /.nav-collapse -->
    </div>
  </div><!-- /navbar-inner -->
</div>

      <section class="well">
  <a class="label" href="/tag/character set">character set (3)</a> <a class="label" href="/tag/collation">collation (3)</a> <a class="label" href="/tag/mysql">mysql (8)</a> <a class="label" href="/tag/bash">bash (1)</a> <a class="label" href="/tag/command">command (1)</a> <a class="label" href="/tag/rm">rm (1)</a> <a class="label" href="/tag/svn">svn (1)</a> <a class="label" href="/tag/convert">convert (1)</a> <a class="label" href="/tag/characters">characters (1)</a> <a class="label" href="/tag/replace">replace (1)</a> <a class="label" href="/tag/insert">insert (1)</a> <a class="label" href="/tag/select">select (1)</a> <a class="label" href="/tag/copy">copy (1)</a> <a class="label" href="/tag/permissions">permissions (1)</a> <a class="label" href="/tag/duplicates">duplicates (1)</a> <a class="label" href="/tag/cakephp">cakephp (5)</a> <a class="label" href="/tag/guide">guide (1)</a> <a class="label" href="/tag/migration">migration (1)</a> <a class="label" href="/tag/authentication">authentication (1)</a> <a class="label" href="/tag/http">http (1)</a> <a class="label" href="/tag/security">security (2)</a> <a class="label" href="/tag/find">find (1)</a> <a class="label" href="/tag/position">position (1)</a> <a class="label" href="/tag/vhosts">vhosts (1)</a> <a class="label" href="/tag/olap">olap (1)</a> <a class="label" href="/tag/reporting">reporting (1)</a> <a class="label" href="/tag/schema">schema (1)</a> <a class="label" href="/tag/star">star (1)</a> <a class="label" href="/tag/javascript">javascript (1)</a> <a class="label" href="/tag/scope">scope (1)</a> <a class="label" href="/tag/variables">variables (1)</a> <a class="label" href="/tag/design">design (2)</a> <a class="label" href="/tag/modular">modular (1)</a> <a class="label" href="/tag/plugins">plugins (1)</a> <a class="label" href="/tag/array">array (1)</a> <a class="label" href="/tag/php">php (2)</a> <a class="label" href="/tag/css">css (1)</a> <a class="label" href="/tag/projekktor">projekktor (1)</a> <a class="label" href="/tag/espresso">espresso (2)</a> <a class="label" href="/tag/extraction">extraction (3)</a> <a class="label" href="/tag/iphone">iphone (5)</a> <a class="label" href="/tag/bugs">bugs (1)</a> <a class="label" href="/tag/memory warning">memory warning (1)</a> <a class="label" href="/tag/nginx">nginx (2)</a> <a class="label" href="/tag/wordpress">wordpress (2)</a> <a class="label" href="/tag/mime">mime (1)</a> <a class="label" href="/tag/ruby">ruby (4)</a> <a class="label" href="/tag/savon">savon (1)</a> <a class="label" href="/tag/soap">soap (1)</a> <a class="label" href="/tag/rails">rails (2)</a> <a class="label" href="/tag/devise">devise (1)</a> 
</section>
    </header>
    <div id="main">
      <div id="content">
        <div class="row">
  
  <div class="span8 blog-index">
    
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/17/shelling-out-from-a-ruby-app-to-a-ruby-app-without-bundler-conflicts/">Shelling Out From a Ruby App to a Ruby App Without Bundler Conflicts</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-17T00:00:00+02:00" pubdate data-updated="true">Jul 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My case is that I have a Rails app. It uses Bundler to manage its Gems.</p>

<p>I also need to run some processing using an old version of one of my own libraries which also has dependencies and gems that need resolving. I chose to make this a small command line app with an executable ruby file. This little tool uses Bundler to manage its Gems.</p>

<p>I will shell out to this executable from my Rails app. Simple, right? I thought it would, but there was a gotcha. The Rails app executes the external ruby file within the same &#8220;bundle&#8221; as the Rails app. I.E. I got the current versions of my lib and all gems.</p>

<p>After much Googling I combined one Stack Overflow answer with a note on some blog (lost both references).</p>

<pre lang="ruby">
some_result_value = ""
Bundler.with_clean_env do
  Dir.chdir "/path/to/rubytool"
  some_result_value = `./bin/rubytool param1 param2`
end
</pre>


<p>The key details here are the clean environment AND that I change directory before executing. I don&#8217;t understand why changing the folder would be significant. It may even have been bad late-night mojo.</p>

<p>Anyway, as long as the command line tool being called uses bundler correctly it works ar intended. It is run with its own bundle of gems.</p>

<p>I would like to find a way to control this from the receiving ruby script but I have not looked into that yet.</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/29/winning-two-gsma-global-mobile-awards/">Winning Two GSMA Global Mobile Awards</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-29T00:00:00+01:00" pubdate data-updated="true">Feb 29<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://www.eimermusic.com/cms/wp-content/uploads/2012/02/logo_02.png" alt="" title="GSMA Global Awards 2012" width="380" height="100" class="size-full wp-image-186" /></p>

<p>Yesterday, Feb 28 2012, <a href="http://www.greatconnection.se/" title="Great Connection Inc">Great Connection Inc</a>, the company I co-founded and work for, won two <a href="http://www.globalmobileawards.com/winners2012.php">GSMA Global Mobile Awards</a>. We won both categories relating to healthcare and both our nominations. As this is the equivalent to an Oscar or a Grammy in our industry, but far less glamourous, it&#8217;s pretty awesome.</p>

<p>We won for <a href="http://www.globalmobileawards.com/winners2012.php#cat_id15">Best Mobile Health Innovation</a> and <a href="http://www.globalmobileawards.com/winners2012.php#cat_id12">mWomen Best Mobile Product or Service for Women in Emerging Markets</a>. As the product designer, lead developer and inventor I am most touched by the the fact that the Judges comments seem to recognize the work of my co-developer and myself.</p>

<blockquote>Good initiative concerning maternal health. Nice convergence of a number of technologies in a critical area of need.</blockquote>


<p>It is not easy to grasp a technical system and product like ours. Mobile Baby spans two very different industries: healthcare and mobile, and also cross many &#8220;glass walls&#8221;. Professional and consumer, men and women, rural and urban and many others. We have built a product that is irreverent towards pre-conceived notions in both healthcare IT and mobile communications and struggle to be understood and accepted in either industry.</p>

<p>The TL;DR or what Mobile Baby is that we connect medical imaging equipment, mainly ultrasound, to the internet and run a hosted &#8220;cloud&#8221; system tailored to making geography and time a non-issue in the healthcare workflow. Images are available in clinical grade formats online in our web-based application and can be downloaded and opened in Imaging workstation software on iPhones, iPads or &#8220;real&#8221; computers.</p>

<p>The feature that most people can relate to is the systems ability to provide expecting parents with high-rez images and videos in consumer-friendly digital formats for viewing at home and forwarding to family and friends. The same messaging features that give parents images on their phones is also used to alert doctors of new cases and examinations.</p>

<p>Anyway. I am proud, both for myself but most for my colleges and partners at Qualcomm and Etisalat. Without all these people (too many to mention) and their ability to connect with people and generate interest, hype and trust, I would still be designing this product in even more obscurity than today. :)</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/09/looping-through-large-and-slow-datasets-in-ruby/">Looping Through Large and Slow Datasets in Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-09T00:00:00+01:00" pubdate data-updated="true">Nov 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently had the pleasure of needing to load 30&#8217;000 records from MongoDB and then performing slow and memory intensive processing on them. Basically you can imagine it as a database of videos and MongoDB was holding the metadata and other bits but the actual video files were on disk somewhere. My parsing involved loading in the entire video in memory and doing &#8220;stuff&#8221; with it as part of my model object.</p>

<p>This is how I did it.</p>

<h2>Take 1</h2>

<p>At first I just did the normal Model.all.each&#8230; This worked fine for smaller datasets but on larger sets the whole thing would crash after 40 to 60 minutes (I never timed this in detail). MongoDB had timed out and I figured out that my ODM (Mongoid) was keeping an open iterator in MongoDB and fetching one document at a time from the DB&#8230; and after an hour or so the DB had had enough.</p>

<h2>Take 2</h2>

<p>It was of-course trivial to force Mongoid to load the whole dataset in one go using Model.all.to_a.each&#8230; Before thinking further I set this version going. It crashed a lot faster than the first version. The reason is that each of my objects stay in the array, and in memory, and adding anywhere from 5 to 500 MB of videodata to each quickly ate all RAM I had.</p>

<h2>Take 3</h2>

<p>The small and funky change fixed this, making my script both time and ram &#8220;proof&#8221;. This is how I will start out next time I have a long-running task.</p>

<pre lang="ruby">
all = Model.all.to_a # these are just simple Rails models
while one = all.pop # this is memory management
    one.do_heavy_processing # this loads in a ton of crap
end</pre>


<p>By popping them off one by one and re-using the local variable Ruby&#8217;s GC takes pretty good care of keeping the memory to a minimum.</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/03/quick-tip-ios-and-web-graphics-in-illustrator/">Quick Tip: iOS and Web Graphics in Illustrator</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-03T00:00:00+01:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wanted to make a note of one of these things I keep forgetting in Adobe Illustrator. It is very simple, obvious and keeps me sane while drawing UI elements.</p>

<p><img src="http://www.eimermusic.com/cms/wp-content/uploads/2011/11/transform-web.png" alt="" title="Transform Pane" width="216" height="125" class="size-full wp-image-179" /></p>

<p><strong>Make sure &#8220;Align to Pixel Grid&#8221; is actually selected!</strong></p>

<p>That gets you out of so much trouble. Problem is, you need to keep an eye on the transform pane since this is a per-object setting. It is nog global to everything on your canvas.</p>

<p>Of-course the old-school technique of placing the strokes outside (or inside) the object bounds still works and can actually help you in transferring dimensions from the canvas into CSS (which puts borders &#8220;outside&#8221; when working correctly).</p>

<p>(I can&#8217;t believe they still haven&#8217;t fixed the rounding errors that randomly occur when drawing and moving objects around.)</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/07/26/patents-gone-crazy/">Patents Gone Crazy</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-26T00:00:00+02:00" pubdate data-updated="true">Jul 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am in the middle of some patent applications in the US at the same time as all the recent press about patent &#8220;trolls&#8221; going after small (and large) iOS developers. These things have made me think more than usual about the patent system.</p>

<p>I think the root problems are the following:</p>

<ol>
    <li>Legal costs or defending your patent or yourself from someone else&#8217;s patent affect the whole patent system. And not for the better.</li>

    <li>Patents were meant to protect an inventor from copycats&#8230; under the aparent assumption that nonone could independently come up with something near-identical to another invention. That is: you should really only be able to patent things where the likelihood of an independent near-identical invention are slim-to-none. There is nothing in the system that requires you to prove something is a copy&#8230; it is just assumed and this works really poorly today, especially in software, where people come up with the same thing independently all the time. </li>

    <li>The key term defining what is patentable, &#8220;non-obvious to someone skilled in the arts&#8221;, has eroded significantly. I believe that both the level of &#8220;skill&#8221; and how much research is required for something to be &#8220;non-obvious&#8221; have been lowered. Sometimes to ridiculous levels.</li>
</ol>


<p>I believe the only long-term solution is to invalidate a whole lot of patents and to create a body doing these invalidations without the economic problems associated with lawsuits and courts. This is going to mess things up for a lot of companies and I am skeptical that we&#8217;ll ever see a significant change.</p>

<p>The applications I have written should probably not be granted patents, ethically speaking. On the other hand they are no worse than many many patents already granted and the lawyers see it as a sure thing that we&#8217;ll be granted these patents.</p>

<p>It is a very wired position to be in.</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/24/transitioning-to-more-secure-passwords/">Transitioning to More Secure Passwords</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-24T00:00:00+02:00" pubdate data-updated="true">Jun 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With all the news of hacked databases (mostly at Sony) and the clear-text or poorly hashed passwords in their datasets, I thought I might offer my standard trick for transitioning to a more secure form of hashing.</p>

<p>I think some sites don&#8217;t change passwords security for fear of annoying users or the workload involved in managing a transition. This simple technique is completely invisible to the user and very low maintenance for the developer.</p>

<p>I will be giving examples from the Devise library for Rails apps, since I recently implemented it there.</p>

<h2>The technique is very very simple</h2>

<p>You configure your authentication to check passwords against both the old and the new form of hashed password. And when you find a match for the old hash you update your database with the version of the password encoded using the new hash. You keep this dual check in place until all (or most likely most) of your users have logged in and had their passwords changed. The unlucky few can use your password recovery feature if you have one.</p>

<p>Metacode of the basic principle:</p>

<pre lang="ruby">
if new_hash(password) == stored_password
  // ALLOW LOGIN USING AN UP-TO-DATE PASS
else
  if old_hash(password) == stored_password
    // UPDATE PASSWORD IN DB
    // ALLOW LOGIN
  else
    // DISALLOW LOGIN
  end
end
</pre>


<h2>How to implement this transition in Devise</h2>

<p>I implemented this by overriding the method <strong>valid_password?</strong> injected into your User model.</p>

<pre lang="ruby">
class User

  def valid_password?(incoming_password)
    result = super incoming_password
    if !result
      # try old encryptor during transition
      digest = Devise::Encryptors::LegacyEncryptor.digest(incoming_password, self.class.stretches, self.password_salt, self.class.pepper)
      result = Devise.secure_compare(digest, self.encrypted_password)
      if result
        # update password to use new encryptor when there is a match
        self.password = incoming_password
        self.save
      end
    end
    result
  end

end
</pre>


<p>Fairly simple. You may need to hard-code some parameters (salt, stretching, pepper) if they cause problems.</p>

<p>If you are changing from, say, sha1 to sha256, you can easily check the character lengths of the passwords in your database to check the &#8220;adoption rate&#8221; of the new hashes.</p>

<h2>Implications on Security</h2>

<p>You should realize that you ARE lowering your security level slightly by effectively allowing 2 different password checks. In reality this problem is small and only really matters if you have plain passwords you are transitioning from (and you really shouldn&#8217;t have). The problem then becomes real since I could login using a stolen new (supposedly) secure hash as the given password. In this case I would definitely disallow any password of the same length as, or simple reg-ex match for, your new hashing system to avoid this hole.</p>

<p>You will also not fully benefit from the new hashing system until you remove the &#8220;dual check&#8221; after a reasonable period of time.</p>

<p>If you can live with that to gain the benefits of a clean migration for you and your users this is a nice technique. I know from reading and talking to developers that I am far from the only of the first to come up with something like this. Many apps and sites have used and continue to use this kind of technique to beef-up password hash-strength without bothering users.</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/18/am-i-fierce/">Am I Fierce?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-18T00:00:00+02:00" pubdate data-updated="true">May 18<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I love Dropbox and use it every day. I love Flipboard and use it every day.</p>

<p>So imagine my reaction to seeing my (and my co-founders&#8217;) little company named as one of the 15 coolest young companies in the world next to all these great companies. That was really special.</p>

<p><a href="http://www.fiercewireless.com/special-reports/great-connection-mobile-medical-wireless-startups-fierce-15-2011">Fierce Wireless about Great Connection</a></p>

<p>They didn&#8217;t get all the details right but if you want to know what I am up to most of the time I have seen worse descriptions. ;)</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/17/minimalist-wordpress-deployment/">Minimalist Wordpress Deployment</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-17T00:00:00+02:00" pubdate data-updated="true">May 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So, my &#8220;sugar daddy&#8221; datacenter is kicking me out. This is where I have been hosting absolutely free for a decade so I have nothing bad to say about them&#8230; at all. :-)</p>

<p>My 4U quad-core2duo, 4GB RAM, 8TB SATA beast will soon become homeless&#8230;. Did I mention they let me host that monster for free?</p>

<p>This website was a minor task for that server but last Sunday I moved it onto a minuscule &#8220;cloud&#8221; VPS at <a href="http://www.glesys.se/">Gelsys</a>. Running PHP and MySQL on 256MB of RAM (and no swap) and expecting a stable server under load did require some tinkering. I am not going to detail every little thing. I&#8217;ll only outline the basic setup.</p>

<p>I have Wordpress spitting out static html files which is what is being served for 99% of all requests. PHP is only being called on to re-generate the files when the caches expire and to serve up the admin interface. In this way my mini-VPS can handle a pretty decent amount of traffic. I don&#8217;t generally get a lot of traffic but I am curious to see how the server behaves during a spike.</p>

<p>Wordpress caching is handled by the excellent W3 Total Cache plugin which recently got official support for Nginx. Yay! no more custom rewrite rules. My only problem getting it running this time was that it refused to cache the index page, which is kind-of bad when it is one of the heaviest pages to render. Turned out it was a simple precedence issue. &#8220;/&#8221; is considered a folder which I caught in a rule before the caching rules had a chance to do their thing.</p>

<p>Nginx is the web server. I have been running it for a few years already but for this it is absolutely essential to save on ram and get the best performance serving static files.</p>

<p>PHP is called from Nginx over an unix socket and served by php-fpm. PHP is compiled with my favorite accelerator eaccelerator. It is just the simplest to get going and has shown good performance for my apps. PHP has been scaled down a lot in php.ini, reducing mainly memory usage and timeouts.</p>

<p>MySQL loves memory so I had to do the equivalent here. Basically taking the standard performance tips and doing the opposite. I know I will only server Wordpress and I know I don&#8217;t have any enormous datasets so MySQl should be fine on very low memory. Also since I limit the number of php processes I consequently limit the maximum number of client connections MySQL will need to keep track of.</p>

<p>The only other service running is ssh and I was surprised to find that sftp was one of the biggest memory hogs. Uploading a bunch of files of sftp and the server would immediately come dangerously close to running our of memory. In fact it did a bunch of times during my tweaking.</p>

<p>I have been thinking about switching from Wordpress to some static website generator but that is for another time. This setup looks fairly smooth at the moment.</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/01/19/graylog2-on-mac-os-x/">Graylog2 on Mac OS X</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-19T00:00:00+01:00" pubdate data-updated="true">Jan 19<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been playing with Graylog2 on my Mac today. Since the setup guides are all for Debian and not fully compatible with Mac OS X I thought I&#8217;d mention the changes I needed to make to get thing rolling smoothly.</p>

<p>The guides are good, so go read them in the wikis on Github. I won&#8217;t re-iterate them, only point out the minor changes and tweaks I had to make.</p>

<p>Graylog2 comes in two main parts. The server and the web interface. I&#8217;ll start with the server component.</p>

<h2>Install The Server</h2>

<p><a href="https://github.com/Graylog2/graylog2-server/wiki/Installing">https://github.com/Graylog2/graylog2-server/wiki/Installing</a></p>

<p>Mac OS X has java bundled with the OS (for now). There is no need to install anything. The configuration file needs one non-obvious tweak.</p>

<pre lang="bash">

mongodb_host = 127.0.0.1 # localhost

</pre>


<p>Java resolves localhost to the strangest thing. It tries to connect to the Bonjour name and external IP (e.g. Martin&#8217;s Mac/192.168.0.2) instead of 127.0.0.1 which is what you want. Instead of opening MongoDB up to external access I changed the configuration to point to the loopback IP directly.</p>

<h2>Starting The Server</h2>

<p><a href="https://github.com/Graylog2/graylog2-server/wiki/Starting-the-server">https://github.com/Graylog2/graylog2-server/wiki/Starting-the-server</a></p>

<p>I didn&#8217;t get the daemon script to start and did not investigate is since I run Graylog2 for evaluation and development and like seeing the output. Starting by running the jar file requires that you sudo.</p>

<pre lang="bash">

sudo java -jar graylog2-server.jar debug

</pre>


<p>That gets Graylog2 running and spitting out a lot of fun info so you know you are logging thing as you expect.</p>

<h3>Installing The Web Interface</h3>

<p><a href="https://github.com/Graylog2/graylog2-web-interface/wiki/Installing-the-web-interface-on-Debian-5.0">https://github.com/Graylog2/graylog2-web-interface/wiki/Installing-the-web-interface-on-Debian-5.0</a></p>

<p>You can follow most of those steps if you don&#8217;t have rails and Bundler and that stuff installed. For testing and development, I would suggest running the interface using Passenger Standalone instead of Apache. And, you install Passenger as a gem and not apt, of-course.</p>

<p><a href="http://www.modrails.com/documentation/Users%20guide%20Standalone.html">http://www.modrails.com/documentation/Users%20guide%20Standalone.html</a></p>

<p>The cool thing about installing passenger standalone is that it will compile and run itself the first time you call passenger start. It will take a few minutes that first time but after that it will start instantly.</p>

<h2>Logging from your Rails app</h2>

<p><a href="https://github.com/Graylog2/graylog2_exceptions">https://github.com/Graylog2/graylog2_exceptions</a></p>

<p>In the Rails app I want to log from I installed Graylog2 Exceptions. It is a small Rack middleware with practically no configuration. Only problem is that it has not been updated to comply with the current version of the Graylog2 server. Until it is updated, you have to modify the source for it. A very small mod. For me it is ok as long as I am still on my Mac and not a server.</p>

<p>first</p>

<pre lang="bash">
> cd /to/my/app/dir
> bundle open graylog2_exceptions
</pre>


<p>This should get you the installed gem open in your editor.
In the file lib/graylog2_exceptions.rb you need to add the version parameter to the notification message. Possibly this should be added to the gelf gem instead. I am not sure how that version string is supposed to be used.</p>

<p>Here is the modified method that does the actual notification:</p>

<pre lang="ruby">
  def send_to_graylog2 err
    begin
      notifier = GELF::Notifier.new(@args[:hostname], @args[:port])
      puts notifier.notify!(
        :version => "1.0",
        :short_message => err.message, # <- this line is new!!!
        :full_message => err.backtrace.join("\n"),
        :level => @args[:level],
        :host => @args[:local_app_name],
        :file => err.backtrace[0].split(":")[0],
        :line => err.backtrace[0].split(":")[1]
      )
    rescue => i_err
      puts "Graylog2 Exception logger. Could not send message: " + i_err.message
    end
  end
</pre>


<p>So, that is it. Finally I get all my exceptions in Graylog2. To try it out you can just raise some dummy exception – raise &#8220;Dummy Exception Error&#8221; – here and there and see them pop up in Graylog2.</p>
</div>
  
  


      </article>
    
    
      <article>
        
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/24/rails-migration-of-indexes/">Rails Migration of Indexes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-24T00:00:00+01:00" pubdate data-updated="true">Nov 24<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A small gotcha when changing indexes in a migration. To change an index one has to first remove it and then add it again. Removing an index is the tricky part.</p>

<p>The documentation states:
remove_index(table_name, index_name): Removes the index specified by index_name.</p>

<p>This is not strictly true as it turns out. The docs should probably say:
remove_index(table_name, column_name)</p>

<p>The crux is that one cannot use this syntax to remove a named index. Rails assumes the index is named something like &#8220;tablename_columnname_index&#8221; or something similar.</p>

<p>To remove a named index one has to use the block syntax afaik:</p>

<pre lang="ruby">
change_table :tablename do |t|
  t.remove_index :name => :indexname
  t.index ["columnname"], :name => "indexname", :unique => true
end
</pre>

</div>
  
  


      </article>
    
    <div class="pagination">
      
        <a class="prev" href="/blog/page/2/">&larr; Older</a>
      
      <a href="/blog/archives">Blog Archives</a>
      
    </div>
  </div>

  
  <div class="span4 sidebar">
    <div class="well">
      
        <section>
  <h2>Recent Posts</h2>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/17/shelling-out-from-a-ruby-app-to-a-ruby-app-without-bundler-conflicts/">Shelling out from a ruby app to a ruby app without bundler conflicts</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/29/winning-two-gsma-global-mobile-awards/">Winning Two GSMA Global Mobile Awards</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/09/looping-through-large-and-slow-datasets-in-ruby/">Looping through large and slow datasets in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/03/quick-tip-ios-and-web-graphics-in-illustrator/">Quick Tip: iOS and web graphics in Illustrator</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/07/26/patents-gone-crazy/">Patents Gone Crazy</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/articles'>Articles (8)</a></li><li><a href='/blog/categories/code'>Code (12)</a></li><li><a href='/blog/categories/general-interest'>General Interest (10)</a></li><li><a href='/blog/categories/milestones-in-music'>Milestones in Music (15)</a></li><li><a href='/blog/categories/the-pensive'>The Pensive (17)</a></li></ul>
</section>

<section>
  <h2>GitHub Repos</h2>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/eimermusic">@eimermusic</a> on GitHub
  
  <script type="text/javascript">
    $(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'eimermusic',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h2>Latest Tweets</h2>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
    <a href="http://twitter.com/eimer" class="twitter-follow-button" data-show-count="false">Follow @eimer</a>
  
</section>


      
    </div>
  </div>



</div>
      </div>
    </div>
    <footer class="footer"><p>
  Copyright &copy; 2013 - Martin Westin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> -
  
    <span class="credit">Theme by <a href="http://brianarmstrong.org">Brian Armstrong</a></span>
  
</p>
</footer>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>








  </div>
</body>
</html>
